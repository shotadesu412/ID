{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-9">
        <h2 class="text-center mb-4">写真で質問→解説</h2>

        <!-- 質問フォーム -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body p-4">
                <h5 class="card-title fw-bold mb-3">質問画像をアップロード</h5>
                <form method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <div class="mb-4">
                        <label class="form-label fw-bold me-3">学年を選択：</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="grade" id="grade_middle" value="middle"
                                checked>
                            <label class="form-check-label" for="grade_middle">中学生</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="grade" id="grade_high" value="high">
                            <label class="form-check-label" for="grade_high">高校生</label>
                        </div>
                    </div>

                    <div class="mb-4 border rounded p-3 bg-light text-center" style="border-style: dashed !important;">
                        <input type="file" class="form-control" name="image" accept="image/*" required>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">送信</button>
                </form>
            </div>
        </div>

        <!-- 履歴 -->
        <h5 class="fw-bold">履歴</h5>
        {% if history %}
        {% for item in history %}
        <div class="card mb-3">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">{{ item.created_at.strftime('%Y-%m-%d %H:%M') }} | {{ "中学生" if
                    item.grade == "middle" else "高校生" }}</h6>

                {% if item.explanation_status == 'completed' %}
                <div class="mt-3 bg-light p-3 rounded">
                    <pre style="white-space: pre-wrap;" class="mb-0">{{ item.explanation }}</pre>
                </div>
                {% elif item.explanation_status == 'failed' %}
                <p class="text-danger mt-2">解説の生成に失敗しました: {{ item.explanation }}</p>
                {% else %}
                <p class="text-info mt-2"><i class="spinner-border spinner-border-sm"></i> 解説を作成中...</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p class="text-muted">まだ質問履歴はありません</p>
        {% endif %}

    </div>
</div>
{% endblock %}